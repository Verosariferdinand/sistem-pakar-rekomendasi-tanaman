<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pakar Rekomendasi Tanaman</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Sistem Pakar Rekomendasi Tanaman</h1>
            <p>Temukan tanaman yang tepat untuk lahan Anda berdasarkan kondisi tanah menggunakan metode Forward Chaining</p>
        </div>
        
        <div class="content">
            <div class="info-section">
                <div class="tulisan">
                <h3>Tentang Sistem Ini</h3>
                <p>Sistem pakar ini menggunakan metode <strong>Forward Chaining</strong> untuk menganalisis karakteristik tanah Anda dan memberikan rekomendasi tanaman yang paling cocok. Masukkan data kondisi tanah Anda untuk mendapatkan rekomendasi yang akurat.</p>
                </div>
                
                <div class="info-grid">
                    <div class="info-item">
                        <h4><i class="bi bi-globe-asia-australia-fill"></i> Jenis Tanah</h4>
                        <p>Lempung, Pasir, Gambut, Humus, Liat, Kapur</p>
                    </div>
                    <div class="info-item">
                        <h4><i class="bi bi-eyedropper"></i> pH Tanah</h4>
                        <p>4.0 - 9.0 (Asam, Netral, Basa)</p>
                    </div>
                    <div class="info-item">
                        <h4><i class="bi bi-moisture"></i> Kelembaban</h4>
                        <p>0% - 100% (Rendah, Sedang, Tinggi)</p>
                    </div>
                    <div class="info-item">
                        <h4><i class="bi bi-thermometer-sun"></i> Suhu</h4>
                        <p>15Â°C - 35Â°C (Sejuk, Hangat)</p>
                    </div>
                </div>
            </div>
            
            <form id="soilForm" class="form-section">
                <h3><i class="bi bi-clipboard-data-fill"></i> Masukkan Data Kondisi Tanah</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="soil_type">Jenis Tanah</label>
                        <select id="soil_type" name="soil_type" required>
                            <option value="">Pilih jenis tanah</option>
                            <option value="lempung">Lempung (Clay Loam)</option>
                            <option value="pasir">Pasir (Sandy)</option>
                            <option value="gambut">Gambut (Peat)</option>
                            <option value="humus">Humus (Organic)</option>
                            <option value="liat">Liat (Clay)</option>
                            <option value="kapur">Kapur (Limestone)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="ph">pH Tanah</label>
                        <input type="number" id="ph" name="ph" min="4.0" max="9.0" step="0.1" required>
                        <div class="range-info">Rentang: 4.0 - 9.0 (Asam < 6.0, Netral 6.0-7.5, Basa > 7.5)</div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="moisture">Kelembaban Tanah (%)</label>
                        <input type="number" id="moisture" name="moisture" min="0" max="100" step="1" required>
                        <div class="range-info">Rentang: 0-100% (Rendah < 40%, Sedang 40-70%, Tinggi > 70%)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="temperature">Suhu Rata-rata (Â°C)</label>
                        <input type="number" id="temperature" name="temperature" min="15" max="35" step="0.5" required>
                        <div class="range-info">Rentang: 15-35Â°C (Sejuk < 20Â°C, Hangat â‰¥ 20Â°C)</div>
                    </div>
                </div>
                
                <button type="submit" class="submit-btn"><i class="bi bi-search"></i> Analisis & Dapatkan Rekomendasi</button>
            </form>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Menganalisis kondisi tanah Anda...</p>
            </div>
            
            <div class="results" id="results">
                <div id="inputSummary" class="input-summary"></div>
                <h3>Rekomendasi Tanaman</h3>
                <div id="plantCards" class="plant-cards"></div>
            </div>
        </div>
        <footer>
            <div class="footer">
                <p class="copyright">&copy; 2025 Sistem Pakar Rekomendasi Tanaman. All rights reserved.</p>
                <p>Developed by Veros A.(022), Amalia R. A.(023), Brigide T. L (020), Indri A. W.(005)</p>
            </div>
        </footer>
    </div>
    
    <script>
        document.getElementById('soilForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Ambil data dari form
            const formData = {
                soil_type: document.getElementById('soil_type').value,
                ph: parseFloat(document.getElementById('ph').value),
                moisture: parseFloat(document.getElementById('moisture').value),
                temperature: parseFloat(document.getElementById('temperature').value)
            };
            
            // Validasi input
            if (!formData.soil_type || !formData.ph || !formData.moisture || !formData.temperature) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            // Tampilkan loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            
            try {
                // Kirim request ke server
                const response = await fetch('/recommend', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                // Sembunyikan loading
                document.getElementById('loading').style.display = 'none';
                
                if (data.success) {
                    displayResults(data);
                } else {
                    alert('Terjadi kesalahan: ' + data.error);
                }
                
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                alert('Terjadi kesalahan koneksi: ' + error.message);
            }
        });
        
        function displayResults(data) {
            const { recommendations, input_summary } = data;
            
            // Tampilkan ringkasan input
            const summaryDiv = document.getElementById('inputSummary');
            summaryDiv.innerHTML = `
                <h4 style="text-align:center"><i class="bi bi-clipboard-data-fill"></i> Ringkasan Kondisi Tanah Anda</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 10px;">
                    <div><strong>Jenis Tanah:</strong> ${input_summary.soil_type.charAt(0).toUpperCase() + input_summary.soil_type.slice(1)}</div>
                    <div><strong>pH:</strong> ${input_summary.ph} (${input_summary.ph_category.charAt(0).toUpperCase() + input_summary.ph_category.slice(1)})</div>
                    <div><strong>Kelembaban:</strong> ${input_summary.moisture}% (${input_summary.moisture_category.charAt(0).toUpperCase() + input_summary.moisture_category.slice(1)})</div>
                    <div><strong>Suhu:</strong> ${input_summary.temperature}Â°C (${input_summary.temperature_category.charAt(0).toUpperCase() + input_summary.temperature_category.slice(1)})</div>
                </div>
            `;
            
            // Tampilkan rekomendasi tanaman
            const cardsDiv = document.getElementById('plantCards');
            
            if (recommendations.length > 0) {
                cardsDiv.innerHTML = recommendations.map(plant => `
                    <div class="plant-card">
                        ${plant.match_score ? `<div class="match-score">Match: ${plant.match_score}/7</div>` : ''}
                        <h4>ðŸŒ± ${plant.name}</h4>
                        <div class="plant-info">
                            <strong><i class="bi bi-hourglass-split"></i> Waktu Tanam:</strong> ${plant.waktu_tanam}
                        </div>
                        <div class="plant-tips">
                            <strong><i class="bi bi-lightbulb"></i> Tips:</strong> ${plant.tips}
                        </div>
                    </div>
                `).join('');
                
                // Tampilkan informasi tambahan
                const additionalInfo = document.createElement('div');
                additionalInfo.className = 'info-section';
                additionalInfo.style.marginTop = '20px';
                additionalInfo.innerHTML = `
                    <h4>Informasi Tambahan</h4>
                    <p><strong>Metode Analisis:</strong> Forward Chaining - Sistem menganalisis kondisi tanah Anda dan mencocokkan dengan knowledge base berisi ${Object.keys(data.input_summary).length > 0 ? 'lebih dari 20' : ''} aturan tanaman.</p>
                    <p><strong>Rekomendasi:</strong> ${recommendations.length} tanaman yang cocok dengan kondisi tanah Anda.</p>
                    ${recommendations.some(p => p.match_score) ? '<p><strong>Skor Match:</strong> Menunjukkan tingkat kesesuaian tanaman dengan kondisi tanah (semakin tinggi semakin cocok).</p>' : ''}
                `;
                
                cardsDiv.appendChild(additionalInfo);
                
            } else {
                cardsDiv.innerHTML = `
                    <div class="plant-card" style="grid-column: 1 / -1; text-align: center;">
                        <h4>ðŸ˜” Tidak Ada Rekomendasi</h4>
                        <p>Maaf, tidak ditemukan tanaman yang cocok dengan kondisi tanah Anda saat ini.</p>
                        <div class="plant-tips">
                            <strong>ðŸ’¡ Saran:</strong> Coba sesuaikan kondisi tanah dengan menambah pupuk organik, mengatur pH, atau memperbaiki drainase.
                        </div>
                    </div>
                `;
            }
            
            // Tampilkan hasil
            document.getElementById('results').style.display = 'block';
            
            // Scroll ke hasil
            document.getElementById('results').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }
        
        // Fungsi untuk memberikan tooltip pada input
        document.addEventListener('DOMContentLoaded', function() {
            // Tooltip untuk jenis tanah
            const soilSelect = document.getElementById('soil_type');
            const soilTooltips = {
                'lempung': 'Campuran tanah liat, pasir, dan humus. Cocok untuk berbagai tanaman.',
                'pasir': 'Drainase baik, cocok untuk tanaman yang tidak suka air berlebih.',
                'gambut': 'Kaya organik, biasanya asam, cocok untuk tanaman khusus.',
                'humus': 'Sangat subur, kaya nutrisi, cocok untuk sayuran.',
                'liat': 'Menahan air dengan baik, cocok untuk tanaman yang butuh kelembaban tinggi.',
                'kapur': 'pH tinggi (basa), cocok untuk tanaman yang suka tanah alkalis.'
            };
            
            soilSelect.addEventListener('change', function() {
                const selectedValue = this.value;
                if (selectedValue && soilTooltips[selectedValue]) {
                    // Buat tooltip sementara
                    const tooltip = document.createElement('div');
                    tooltip.style.cssText = `
                        position: absolute;
                        background: #2d5a27;
                        color: white;
                        padding: 8px 12px;
                        border-radius: 4px;
                        font-size: 0.9rem;
                        z-index: 1000;
                        max-width: 300px;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                    `;
                    tooltip.textContent = soilTooltips[selectedValue];
                    
                    // Posisikan tooltip
                    const rect = this.getBoundingClientRect();
                    tooltip.style.top = (rect.bottom + window.scrollY + 5) + 'px';
                    tooltip.style.left = rect.left + 'px';
                    
                    document.body.appendChild(tooltip);
                    
                    // Hapus tooltip setelah 3 detik
                    setTimeout(() => {
                        if (tooltip.parentNode) {
                            tooltip.parentNode.removeChild(tooltip);
                        }
                    }, 3000);
                }
            });
            
            // Validasi real-time untuk pH
            const phInput = document.getElementById('ph');
            phInput.addEventListener('input', function() {
                const value = parseFloat(this.value);
                if (value < 4.0 || value > 9.0) {
                    this.style.borderColor = '#e74c3c';
                } else {
                    this.style.borderColor = '#4a7c59';
                }
            });
            
            // Validasi real-time untuk kelembaban
            const moistureInput = document.getElementById('moisture');
            moistureInput.addEventListener('input', function() {
                const value = parseFloat(this.value);
                if (value < 0 || value > 100) {
                    this.style.borderColor = '#e74c3c';
                } else {
                    this.style.borderColor = '#4a7c59';
                }
            });
            
            // Validasi real-time untuk suhu
            const tempInput = document.getElementById('temperature');
            tempInput.addEventListener('input', function() {
                const value = parseFloat(this.value);
                if (value < 15 || value > 35) {
                    this.style.borderColor = '#e74c3c';
                } else {
                    this.style.borderColor = '#4a7c59';
                }
            });
        });
    </script>
</body>
</html>